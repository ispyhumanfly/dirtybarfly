#!/usr/bin/env perl

use Mojolicious::Lite;

#### Pages...

get '/' => sub {

    my $self = shift;
    $self->render( 'index', layout => 'default' );

} => 'index';

get '/places' => sub {

    my $self = shift;
    $self->render( 'places', layout => 'default' );
    
    return $self->redirect_to('index') unless $self->session('name');

} => 'places';

get '/articles' => sub {

    my $self = shift;
    $self->render( 'articles', layout => 'default' );
    
    return $self->redirect_to('index') unless $self->session('name');

} => 'articles';

get '/ads' => sub {

    my $self = shift;
    $self->render( 'ads', layout => 'default' );
    
    return $self->redirect_to('index') unless $self->session('name');

} => 'ads';

#### Functions...

get '/login' => sub {

    my $self = shift;

    if ( $self->param('name') ) {
        
        my $name = $self->param('name');

        $self->session( name => $name );
        $self->redirect_to('index');
    }
    else {

        return $self->render        
    }

} => 'login';

get '/logout' => sub {

    my $self = shift;

    $self->session( expires => 1 );
    $self->redirect_to('index');

} => 'logout';


#### Forms...

post '/query' => sub {

    my $self = shift;

    if ( $self->param('value') ) {
        
        my $value = $self->param('value');

        $self->session( query => $value );
        $self->redirect_to('local');
    }

} => 'query';

app->secret('Insurgent Software Rocks!');
app->start;
