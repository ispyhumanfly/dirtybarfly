#!/usr/bin/env perl

use Mojolicious::Lite;

get '/' => sub {

    my $self = shift;
    $self->render( 'index', layout => 'default' );

} => 'index';

#### Pages...

get '/local' => sub {

    my $self = shift;
    $self->render( 'local', layout => 'default' );
    
    return $self->redirect_to('index') unless $self->session('name');

} => 'local';

get '/news' => sub {

    my $self = shift;
    $self->render( 'news', layout => 'default' );
    
    return $self->redirect_to('index') unless $self->session('name');

} => 'news';

get '/image' => sub {

    my $self = shift;
    $self->render( 'image', layout => 'default' );
    
    return $self->redirect_to('index') unless $self->session('name');

} => 'image';

get '/video' => sub {

    my $self = shift;
    $self->render( 'video', layout => 'default' );
    
    return $self->redirect_to('index') unless $self->session('name');

} => 'video';

#### Functions...

get '/login' => sub {

    my $self = shift;

    if ( $self->param('name') ) {
        
        my $name = $self->param('name');

        $self->session( name => $name );
        $self->redirect_to('index');
    }
    else {

        return $self->render        
    }

} => 'login';

get '/logout' => sub {

    my $self = shift;

    $self->session( expires => 1 );
    $self->redirect_to('index');

} => 'logout';

post '/query' => sub {

    my $self = shift;

    if ( $self->param('value') ) {
        
        my $value = $self->param('value');

        $self->session( query => $value );
        $self->redirect_to('local');
    }
    else {

        return $self->render        
    }

} => 'query';

app->secret('Insurgent Software Rocks!');
app->start;
