<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.1//EN" "http://www.w3.org/TR/xhtml11/DTD/xhtml11.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xmlns:fb="http://www.facebook.com/2008/fbml">

    <head>
	
	<style type="text/css">
	
	    html {
		height:100%;
	    }   
		    
	    body {
		height: 98%;
	    }

	</style>

	<!-- DojoToolkit 1.3 JavaScript Framework -->
	
	<link rel="stylesheet" type="text/css" href="http://ajax.googleapis.com/ajax/libs/dojo/1.3/dijit/themes/nihilo/nihilo.css">
	<script type="text/javascript" src="http://ajax.googleapis.com/ajax/libs/dojo/1.3/dojo/dojo.xd.js" djConfig="parseOnLoad:true" isDebug="true"></script>
        
        <script type="text/javascript">//<![CDATA[
            
            dojo.require("dijit.layout.BorderContainer");
            dojo.require("dijit.layout.ContentPane");
            
        //]]></script>
	
    </head>
    
    <body class='nihilo'>

	<!-- Border Container -->
	
	<div dojoType="dijit.layout.BorderContainer" style="height:100%; width: 100%; border: 1px solid #dedede;">
	
	    <!-- Content Header -->
	    
	    <div dojoType="dijit.layout.ContentPane" region="top">
		
		SocialMAP Prototype v1.0
		
	    </div>
	   
	    <% if ( $self->session('name') ) { %>
		
		<%= content %>
	    
	    <% } else { %>
	    
		<%= include 'login' %>
	    
	    <% } %>	    
	    
	    <!-- Content Footer -->
	    
	    <div dojoType="dijit.layout.ContentPane" region="bottom">
		
		SocialMAP &copy; 2010 Insurgent Software, LLC.
		
	    </div>        

	    <!-- Facebook JavaScript SDK -->
	    
	    <div id="fb-root"></div>
	        
	    <script type="text/javascript">//<![CDATA[
    
		window.fbAsyncInit = function() {
		    
		    FB.init({appId: '151734874839220', status: true, cookie: true, xfbml: true});
		    
		    FB.XFBML.parse();
		    
		    FB.getLoginStatus(function(response) {
  
			if (response.session) {
			    
			    <% unless ( $self->session('name') ) { %>
			
			    window.location = '/signin?name=' + response.uid + '';
			    
			    <% } %>
			}
			else {
    
			    <% if ( $self->session('name') ) { %>
			    
			    window.location = '/signout';
			    
			    <% } %>
			}
		    });
		};
		(function() {
		    
		    var e = document.createElement('script'); e.async = true;
		    e.src = document.location.protocol + '//connect.facebook.net/en_US/all.js';
		    
		    document.getElementById('fb-root').appendChild(e);
		    
		}());
		
	    //]]></script>
    
	</div>
	
    </body>
</html>


