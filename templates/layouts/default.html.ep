<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.1//EN" "http://www.w3.org/TR/xhtml11/DTD/xhtml11.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xmlns:fb="http://www.facebook.com/2008/fbml">

    <head>
	
	<title>SocialMAP</title>
	
	<style type="text/css">
	
	    html {
		height:100%;
	    }   
	    
	    body {
		height: 98%;
		background-color: #999;
	    }
	    
	    a {
		font-weight: bold;
		font-size: 0.9em;
		text-decoration: none;
	    }
	    
	    a:link {
		color: #333;
		
	    }

	    a:visited {
		color: #333;
	    }
	    
	</style>

	<!-- Dojo 1.5 JavaScript Framework -->
	
	<link rel="stylesheet" type="text/css" href="http://ajax.googleapis.com/ajax/libs/dojo/1.5/dijit/themes/soria/soria.css">
	<link rel="stylesheet" type="text/css" href="http://ajax.googleapis.com/ajax/libs/dojo/1.5/dojox/widget/Portlet/Portlet.css">

	<script type="text/javascript" src="http://ajax.googleapis.com/ajax/libs/dojo/1.5/dojo/dojo.xd.js" djConfig="parseOnLoad:true"></script>
        
        <script type="text/javascript">//<![CDATA[
            
            dojo.require("dijit.layout.BorderContainer");
            dojo.require("dijit.layout.ContentPane");
	    dojo.require("dijit.form.Form");
	    dojo.require("dijit.form.TextBox");
	    dojo.require("dijit.form.Button");
	    dojo.require("dijit.layout.AccordionContainer");
	    dojo.require("dijit.TitlePane");
            
        //]]></script>
	
	<% if ( $self->session('user_id') ) { %>
	
	<!-- Google Maps JavaScript API v3 -->
	
	<meta name="viewport" content="initial-scale=1.0, user-scalable=no" />

        <script type="text/javascript">//<![CDATA[
	
	    function initialize() {
		
		var myLatlng = new google.maps.LatLng(42.309815,-83.012695);
	
		var myOptions = {
		    
		    zoom: 8,
		    center: myLatlng,
		    mapTypeId: google.maps.MapTypeId.HYBRID
		};
    
		var map = new google.maps.Map(document.getElementById("map_canvas"), myOptions);
	    }
    	    
	    function loadScript() {
		
		var script = document.createElement("script");
		script.type = "text/javascript";
		script.src = "http://maps.google.com/maps/api/js?sensor=false&region=en-US&callback=initialize";
		document.body.appendChild(script);
	    }
  
	    window.onload = loadScript;
	
        //]]></script>
	
	<% } %>
	
    </head>
    
    <body class='soria'>

	<!-- Border Container -->
	
	<div dojoType="dijit.layout.BorderContainer" style="height:100%; width: 100%;">
	    
	    <!-- Content Header -->
	    
	    <div dojoType="dijit.layout.ContentPane" region="top">
		
		<div style="float: left;">
			
		    <% if ( $self->session('user_id') ) { %>
		    
		    <%= link_to index => {%>
		    Home |
		    <%}%>
		    
		    <%= link_to places => {%>
		    Places |
		    <%}%>

		    <%= link_to stories => {%>
		    Stories |
		    <%}%>

		    <%= link_to ads => {%>
		    Ads
		    <%}%>
			
		    <% } else { %>
		    
		    SocialMAP Prototype v1.0
		    
		    <% } %>
		    
		</div>
		
		<div style="float: right;">
		    
		    <% if ( $self->session('user_id') ) { %>
		    	
		    <div dojoType="dijit.form.Form" encType="multipart/form-data" action="/search" method="POST">
		    
			<div dojoType="dijit.form.TextBox" width="50" name="value"></div>

			<div dojoType="dijit.form.Button">Search</div>
		    
		    </div>
		    
		    <% } %>
		    
		</div>
		
	    </div>
	    
	    <!-- Requested SocialMAP Content Page -->
	    
	    <%= content %>
    	    
	    <!-- Content Footer -->
	    
	    <div dojoType="dijit.layout.ContentPane" region="bottom">

		<%= include 'options' %>
		
		<% unless ( $self->session('user_id') ) { %>
		    
		SocialMAP &copy; 2010 Insurgent Software, LLC.
		    
		<% } %>
		    
	    </div>
    
	    <!-- Facebook JavaScript SDK -->
	    
	    <div id="fb-root"></div>
	        
	    <script type="text/javascript">//<![CDATA[
    
		window.fbAsyncInit = function() {
		    
		    FB.init({appId: '151734874839220', status: true, cookie: true, xfbml: true});
		    
		    FB.getLoginStatus(function(response) {
  
			if (response.session) {
			    
			    <% unless ( $self->session('facebook_id') ) { %>
			    
			    FB.api( '/me', function(facebook) {
			    
				window.location = '/session' +

				    '?facebook_id='	+ facebook.id +				    
				    '&name='		+ facebook.name +
				    '&gender='		+ facebook.gender +
				    '&link='		+ facebook.link +
				    '&email='		+ facebook.email +
				    '&location=' 	+ facebook.location +
				    '&timezone='	+ facebook.timezone + '';
			    });
			    
			    <% } %>
    			}
			else {
    
			    <% if ( $self->session('facebook_id') ) { %>
			    
			    window.location = '/session?expires=1';
			    
			    <% } %>
			}
		    });		    
		};
		(function() {
		    
		    var e = document.createElement('script'); e.async = true;
		    e.src = document.location.protocol + '//connect.facebook.net/en_US/all.js';
		    
		    document.getElementById('fb-root').appendChild(e);
		    
		}());
		
	    //]]></script>
    
	</div>
	
    </body>
</html>


